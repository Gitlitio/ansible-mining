- name: fetch zcash params
  command: "{{ zcash_wallet_fetch_params }}"
  become: yes
  become_user: "{{ zcash_wallet_system_user }}"
  register: zcash_fetch_params_result
  changed_when: "'https://z.cash/downloads/sprout-proving.key' in zcash_fetch_params_result.stdout"

- name: create zcash config directory
  file:
    dest: "{{ zcash_wallet_config_dir }}"
    state: "{{ 'directory' if zcash_wallet_state == 'present' else zcash_wallet_state }}"
    mode: 0755

- name: create zcash config
  template:
    src: zcash.conf.jinja2
    dest: "{{ zcash_wallet_config_dir }}/zcash.conf"
    owner: "{{ zcash_wallet_system_user }}"
    group: "{{ zcash_wallet_system_user }}"
    mode: 0600
  notify: restart zcashd

- name: create zcashd service
  template:
    src: zcashd.service.jinja2
    dest: /etc/systemd/system/{{ zcash_wallet_service }}.service
    owner: root
    group: root
    mode: 0644
  notify: restart zcashd

- name: enable {{ zcash_wallet_service }} service
  systemd:
    name: "{{ zcash_wallet_service }}"
    enabled: yes
    daemon_reload: yes

- meta: flush_handlers

- name: start {{ zcash_wallet_service }} service
  systemd:
    name: "{{ zcash_wallet_service }}"
    state: started
